import { Theme } from "components/theme.slint";
import { StatusBar } from "components/status_bar.slint";
import { LockScreen } from "components/lock_screen.slint";
import { NotificationShade } from "components/notification_shade.slint";
import { DesktopScreen } from "components/desktop.slint";
import { AbstractBackground } from "components/abstract_background.slint";

export component AppWindow inherits Window {
    min-width: 320px;
    min-height: 240px;
    title: "BlackBerry UI";
    default-font-family: Theme.font_sans;

    // Keep these for Rust wiring (even if UI is empty for now).
    in-out property <string> time_text: "12:45";
    in-out property <string> date_text: "Вт, 12 мар";
    in-out property <string> toast_text;
    in-out property <bool> toast_visible: false;
    callback open_app(string);
    in-out property <bool> locked: true;
    in-out property <bool> reduce_motion: false;
    in-out property <int> lock_shimmer_phase: 0;
    in-out property <bool> shade_open: false;

    background: Theme.window_bg;

    StatusBar {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: Theme.status_bar_height;
        date_text: root.date_text;
        time_text: root.time_text;
        wifi_connected: true;
        battery_percent: 100;
    }

    // Extra explicit divider to keep the boundary crisp even if StatusBar style changes.
    Rectangle {
        x: 0px;
        y: Theme.status_bar_height - 1px;
        width: parent.width;
        height: 1px;
        background: Theme.border;
    }

    content := Rectangle {
        x: 0px;
        y: Theme.status_bar_height;
        width: parent.width;
        height: parent.height - Theme.status_bar_height;
        background: #00000000;

        AbstractBackground {
            width: parent.width;
            height: parent.height;
        }

        DesktopScreen {
            width: parent.width;
            height: parent.height;
            time_text: root.time_text;
            date_text: root.date_text;
            reduce_motion: root.reduce_motion;
            open_app(label) => { root.open_app(label); }
        }

        lock := LockScreen {
            width: parent.width;
            height: parent.height;
            time_text: root.time_text;
            date_text: root.date_text;
            reduce_motion: root.reduce_motion;
            shimmer_phase: root.lock_shimmer_phase;
            unlock_requested => { root.locked = false; }

            // Transition to desktop.
            y: root.locked ? 0px : -self.height;
            opacity: root.locked ? 1.0 : 0.0;
            visible: root.locked || self.opacity > 0.0;
            animate y { duration: root.reduce_motion ? 0ms : Theme.anim_med; easing: ease-in-out; }
            animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_med; }
        }

        @children
    }

    NotificationShade {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: parent.height;
        shade_open <=> root.shade_open;
        reduce_motion: root.reduce_motion;
        time_text: root.time_text;
        date_text: root.date_text;
    }
}
