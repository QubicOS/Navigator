import { Theme } from "theme.slint";
import { AppIcon } from "app_icon.slint";

export component DesktopScreen inherits Rectangle {
    background: #00000000;

    in property <string> time_text: "";
    in property <string> date_text: "";
    in property <bool> reduce_motion: false;
    in-out property <int> page_index: 0; // 0 = center, 1 = right

    callback open_app(string);

    pages := Rectangle {
        x: root.page_index == 0 ? 0px : -root.width;
        y: 0px;
        width: root.width * 2;
        height: parent.height;
        background: #00000000;
        clip: true;
        animate x { duration: root.reduce_motion ? 0ms : Theme.anim_med; easing: ease-in-out; }

        // Center panel (info/quick actions).
        center_panel := Rectangle {
            x: 0px;
            y: 0px;
            width: root.width;
            height: parent.height;
            background: #00000000;

            Text {
                x: Theme.gutter;
                y: Theme.gutter + 6px;
                width: parent.width - Theme.gutter * 2;
                text: root.time_text;
                color: Theme.text;
                font-size: 32px;
                font-weight: 900;
                horizontal-alignment: center;
            }

            Text {
                x: Theme.gutter;
                y: Theme.gutter + 46px;
                width: parent.width - Theme.gutter * 2;
                text: root.date_text;
                color: Theme.text_dim;
                font-size: Theme.font_md;
                font-weight: 700;
                horizontal-alignment: center;
            }

            quick := Rectangle {
                x: Theme.gutter;
                y: 90px;
                width: parent.width - Theme.gutter * 2;
                height: 104px;
                background: #00000000;

                property <length> tile_w: (self.width - 20px) / 3;
                property <length> tile_h: 104px;

                AppIcon { x: 0px; width: tile_w; height: tile_h; compact: true; reduce_motion: root.reduce_motion; label: "Настройки"; icon: @image-url("../../assets/settings.png"); activated(label) => { root.open_app(label); } }
                AppIcon { x: (parent.width - tile_w) / 2; width: tile_w; height: tile_h; compact: true; reduce_motion: root.reduce_motion; label: "Терминал"; icon: @image-url("../../assets/terminal.png"); activated(label) => { root.open_app(label); } }
                AppIcon { x: parent.width - tile_w; width: tile_w; height: tile_h; compact: true; reduce_motion: root.reduce_motion; label: "Приложения"; icon: @image-url("../../assets/apps.png"); activated(label) => { root.open_app(label); } }
            }
        }

        // Right panel (apps grid).
        right_panel := Rectangle {
            x: root.width;
            y: 0px;
            width: root.width;
            height: parent.height;
            background: #00000000;

            Text {
                x: Theme.gutter;
                y: Theme.gutter;
                text: "Приложения";
                color: Theme.text;
                font-size: Theme.font_xl;
                font-weight: 800;
            }

            grid := GridLayout {
                x: Theme.gutter;
                y: 28px;
                width: parent.width - Theme.gutter * 2;
                height: parent.height - 28px - Theme.gutter;
                spacing-horizontal: 10px;
                spacing-vertical: 10px;

                property <length> tile_w: (self.width - 20px) / 3;
                property <length> tile_h: 92px;

                AppIcon { row: 0; col: 0; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Почта"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
                AppIcon { row: 0; col: 1; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Чаты"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
                AppIcon { row: 0; col: 2; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Календарь"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
                AppIcon { row: 1; col: 0; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Контакты"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
                AppIcon { row: 1; col: 1; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Браузер"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
                AppIcon { row: 1; col: 2; width: tile_w; height: tile_h; reduce_motion: root.reduce_motion; label: "Медиа"; icon: @image-url("../../assets/unknown.png"); activated(label) => { root.open_app(label); } }
            }
        }
    }

    // Swipe between center <-> right.
    SwipeGestureHandler {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: parent.height;
        handle-swipe-left: true;
        handle-swipe-right: true;

        swiped => {
            if ((self.pressed-position.x - self.current-position.x) > 30px) {
                root.page_index = 1;
            } else if ((self.current-position.x - self.pressed-position.x) > 30px) {
                root.page_index = 0;
            }
        }
    }
}
