import { Theme } from "../theme.slint";

enum SelectionKind {
    None,
    Language,
    DateTime,
}

component IosSectionTitle inherits Text {
    in property <string> title: "";
    text: root.title;
    color: Theme.text_muted;
    font-size: Theme.font_xs;
    font-weight: 700;
}

component IosCard inherits Rectangle {
    background: Theme.surface_bg;
    border-width: 1px;
    border-color: Theme.border;
    border-radius: Theme.radius_md;
    clip: true;
}

component IosSwitch inherits Rectangle {
    in-out property <bool> value: false;
    in property <bool> reduce_motion: false;

    width: 50px;
    height: 28px;
    border-radius: self.height / 2;
    background: root.value ? Theme.accent : Theme.border;
    animate background { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }

    thumb := Rectangle {
        width: 22px;
        height: 22px;
        border-radius: self.height / 2;
        background: Theme.surface_bg;
        y: 3px;
        x: root.value ? parent.width - self.width - 3px : 3px;
        animate x { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.value = !root.value; }
    }
}

component IosRowBase inherits Rectangle {
    in property <string> title: "";
    in property <string> value_text: "";
    in property <bool> show_value: false;
    in property <bool> show_chevron: true;
    in property <bool> show_divider: true;
    in property <bool> reduce_motion: false;
    in property <bool> show_icon: false;
    in property <image> icon;
    in property <bool> multiline: false;

    callback activated();

    height: root.multiline ? 52px : 44px;
    background: #00000000;

    property <length> left_inset: show_icon ? 44px : 12px;
    property <length> right_inset: show_chevron ? 24px : 12px;
    property <length> trailing_gap: 8px;

    touch := TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.activated(); }
    }

    // iOS-like press highlight.
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #00000008;
        opacity: touch.pressed ? 1.0 : 0.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    if (root.show_icon) : Rectangle {
        x: 12px;
        y: 0px;
        width: 26px;
        height: parent.height;
        background: #00000000;
        Image {
            x: (parent.width - 18px) / 2;
            y: (parent.height - 18px) / 2;
            width: 18px;
            height: 18px;
            source: root.icon;
            image-fit: contain;
        }
    }

    title_clip := Rectangle {
        x: root.left_inset;
        y: 0px;
        width: parent.width - root.left_inset - (root.show_value ? 110px : root.right_inset) - root.trailing_gap;
        height: parent.height;
        background: #00000000;
        clip: true;

        Text {
            width: parent.width;
            height: parent.height;
            text: root.title;
            color: Theme.text;
            font-size: Theme.font_sm;
            font-weight: 600;
            vertical-alignment: center;
            wrap: root.multiline ? word-wrap : no-wrap;
        }
    }

    if (root.show_value) : Text {
        x: 0px;
        width: parent.width - root.right_inset;
        height: parent.height;
        text: root.value_text;
        color: Theme.text_dim;
        font-size: Theme.font_sm;
        font-weight: 600;
        horizontal-alignment: right;
        vertical-alignment: center;
    }

    if (root.show_chevron) : Text {
        x: parent.width - 16px;
        y: 0px;
        width: 12px;
        height: parent.height;
        text: "›";
        color: Theme.text_muted;
        font-size: 18px;
        font-weight: 700;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    if (root.show_divider) : Rectangle {
        x: root.left_inset;
        y: parent.height - 1px;
        width: parent.width - root.left_inset;
        height: 1px;
        background: Theme.border;
        opacity: 0.85;
    }
}

component IosSwitchRow inherits Rectangle {
    in property <string> title: "";
    in-out property <bool> value: false;
    in property <bool> show_divider: true;
    in property <bool> reduce_motion: false;
    in property <bool> multiline: false;

    height: root.multiline ? 52px : 44px;
    background: #00000000;

    title_clip := Rectangle {
        x: 12px;
        y: 0px;
        width: parent.width - 12px - 62px - 8px;
        height: parent.height;
        background: #00000000;
        clip: true;

        Text {
            width: parent.width;
            height: parent.height;
            text: root.title;
            color: Theme.text;
            font-size: Theme.font_sm;
            font-weight: 600;
            vertical-alignment: center;
            wrap: root.multiline ? word-wrap : no-wrap;
        }
    }

    IosSwitch {
        x: parent.width - self.width - 12px;
        y: (parent.height - self.height) / 2;
        value <=> root.value;
        reduce_motion: root.reduce_motion;
    }

    if (root.show_divider) : Rectangle {
        x: 12px;
        y: parent.height - 1px;
        width: parent.width - 12px;
        height: 1px;
        background: Theme.border;
        opacity: 0.85;
    }
}

component SettingsNavItem inherits Rectangle {
    in property <string> text: "";
    in property <bool> selected: false;
    in property <bool> reduce_motion: false;
    callback clicked();

    height: 34px;
    background: selected ? Theme.focus_ring : #00000000;
    border-radius: 10px;

    Text {
        x: 10px;
        width: parent.width - 20px;
        height: parent.height;
        text: root.text;
        color: root.selected ? Theme.text : Theme.text_dim;
        font-size: Theme.font_sm;
        font-weight: root.selected ? 700 : 600;
        vertical-alignment: center;
    }

    TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.clicked(); }
    }

    animate background { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }
}

component SettingsToggleRow inherits Rectangle {
    in property <string> label: "";
    in-out property <bool> value: false;
    in property <bool> reduce_motion: false;

    height: 38px;
    background: #00000000;

    Text {
        x: 0px;
        width: parent.width - 72px;
        height: parent.height;
        text: root.label;
        color: Theme.text;
        font-size: Theme.font_sm;
        font-weight: 600;
        vertical-alignment: center;
    }

    track := Rectangle {
        x: parent.width - 58px;
        y: (parent.height - 22px) / 2;
        width: 58px;
        height: 22px;
        border-radius: 11px;
        background: root.value ? Theme.accent : Theme.border;
        animate background { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }

        thumb := Rectangle {
            y: 3px;
            width: 16px;
            height: 16px;
            border-radius: 8px;
            background: Theme.surface_bg;
            x: root.value ? parent.width - self.width - 3px : 3px;
            animate x { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
        }
    }

    TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.value = !root.value; }
    }
}

component SettingsSliderRow inherits Rectangle {
    in property <string> label: "";
    in property <float> minimum: 0;
    in property <float> maximum: 100;
    in property <float> step: 1;
    in-out property <float> value: 50;
    in property <bool> reduce_motion: false;

    height: 44px;
    background: #00000000;

    Text {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: 18px;
        text: root.label;
        color: Theme.text;
        font-size: Theme.font_sm;
        font-weight: 600;
    }

    track := Rectangle {
        x: 0px;
        y: parent.height - 12px;
        width: parent.width;
        height: 4px;
        border-radius: 2px;
        background: Theme.border;

        fill := Rectangle {
            x: 0px;
            y: 0px;
            width: parent.width * (root.value - root.minimum) / max(root.maximum - root.minimum, 1);
            height: parent.height;
            border-radius: parent.border-radius;
            background: Theme.accent;
            animate width { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
        }
    }

    thumb := Rectangle {
        width: 14px;
        height: 14px;
        border-radius: 7px;
        background: Theme.accent;
        y: track.y - (self.height - track.height) / 2;
        x: clamp(track.width * (root.value - root.minimum) / max(root.maximum - root.minimum, 1) - self.width / 2, 0px, track.width - self.width);
        animate x { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    function set-value(v: float) {
        let snapped = root.step > 0 ? (round((v - root.minimum) / root.step) * root.step + root.minimum) : v;
        root.value = max(root.minimum, min(root.maximum, snapped));
    }

    touch := TouchArea {
        width: parent.width;
        height: parent.height;
        pointer-event(event) => {
            if (event.button != PointerEventButton.left) { return; }
            if (event.kind == PointerEventKind.up) { return; }
            root.set-value(root.minimum + touch.mouse-x * (root.maximum - root.minimum) / max(track.width, 1px));
        }
        moved => {
            root.set-value(root.minimum + touch.mouse-x * (root.maximum - root.minimum) / max(track.width, 1px));
        }
    }
}

component SettingsNavScroll inherits Rectangle {
    in property <bool> reduce_motion: false;
    in-out property <int> selected_index: 0;
    // Total number of items; used to compute viewport height.
    in property <int> item_count: 0;

    property <length> item_h: 36px;
    property <length> content_h: item_count * item_h;

    background: #00000000;
    clip: true;

    Flickable {
        width: parent.width;
        height: parent.height;
        interactive: true;

        viewport-height: content_h;
        viewport-width: parent.width;

        content := Rectangle {
            width: parent.width;
            height: content_h;
            background: #00000000;

            // Items are placed by y = index * item_h.
            SettingsNavItem { y: 0 * item_h; width: parent.width; text: "Система"; selected: root.selected_index == 0; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 0; } }
            SettingsNavItem { y: 1 * item_h; width: parent.width; text: "Экран"; selected: root.selected_index == 1; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 1; } }
            SettingsNavItem { y: 2 * item_h; width: parent.width; text: "Звук"; selected: root.selected_index == 2; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 2; } }
            SettingsNavItem { y: 3 * item_h; width: parent.width; text: "Сеть"; selected: root.selected_index == 3; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 3; } }
            SettingsNavItem { y: 4 * item_h; width: parent.width; text: "О системе"; selected: root.selected_index == 4; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 4; } }

            SettingsNavItem { y: 5 * item_h; width: parent.width; text: "Аккаунты"; selected: root.selected_index == 5; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 5; } }
            SettingsNavItem { y: 6 * item_h; width: parent.width; text: "Приватность"; selected: root.selected_index == 6; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 6; } }
            SettingsNavItem { y: 7 * item_h; width: parent.width; text: "Уведомления"; selected: root.selected_index == 7; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 7; } }
            SettingsNavItem { y: 8 * item_h; width: parent.width; text: "Хранилище"; selected: root.selected_index == 8; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 8; } }
            SettingsNavItem { y: 9 * item_h; width: parent.width; text: "Питание"; selected: root.selected_index == 9; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 9; } }
            SettingsNavItem { y: 10 * item_h; width: parent.width; text: "Язык"; selected: root.selected_index == 10; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 10; } }
            SettingsNavItem { y: 11 * item_h; width: parent.width; text: "Дата и время"; selected: root.selected_index == 11; reduce_motion: root.reduce_motion; clicked => { root.selected_index = 11; } }
        }
    }
}

component IosChoiceRow inherits Rectangle {
    in property <string> title: "";
    in property <bool> selected: false;
    in property <bool> show_divider: true;
    in property <bool> reduce_motion: false;
    callback activated();

    height: 44px;
    background: #00000000;

    touch := TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.activated(); }
    }

    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #00000008;
        opacity: touch.pressed ? 1.0 : 0.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    Text {
        x: 12px;
        width: parent.width - 44px;
        height: parent.height;
        text: root.title;
        color: Theme.text;
        font-size: Theme.font_sm;
        font-weight: 600;
        vertical-alignment: center;
        wrap: no-wrap;
    }

    if (root.selected) : Text {
        x: parent.width - 24px;
        width: 18px;
        height: parent.height;
        text: "✓";
        color: Theme.accent;
        font-size: 14px;
        font-weight: 800;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    if (root.show_divider) : Rectangle {
        x: 12px;
        y: parent.height - 1px;
        width: parent.width - 12px;
        height: 1px;
        background: Theme.border;
        opacity: 0.85;
    }
}

component IosPrimaryButton inherits Rectangle {
    in property <string> text: "";
    in property <bool> reduce_motion: false;
    callback clicked();

    height: 38px;
    border-radius: 10px;
    background: @linear-gradient(180deg, Theme.accent 0%, Theme.accent_2 100%);

    Text {
        width: parent.width;
        height: parent.height;
        text: root.text;
        color: Theme.on_accent;
        font-size: Theme.font_md;
        font-weight: 800;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    pressed_layer := Rectangle {
        width: parent.width;
        height: parent.height;
        border-radius: parent.border-radius;
        background: #00000018;
        opacity: touch.pressed ? 1.0 : 0.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }
    }

    touch := TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => { root.clicked(); }
    }
}

export component SettingsApp inherits Rectangle {
    in property <bool> reduce_motion: false;
    in property <string> app_version: "";
    in property <string> runtime_os: "";
    in property <string> runtime_arch: "";
    in property <string> runtime_platform: "";
    in-out property <int> selected_index: 0;

    // demo state (later wire to Rust)
    in-out property <bool> setting_dark_mode: false;
    in-out property <bool> setting_reduce_motion: false;
    in-out property <bool> setting_wifi: true;
    in-out property <bool> setting_bluetooth: false;
    in-out property <float> setting_brightness: 60;
    in-out property <float> setting_volume: 70;
    in-out property <string> setting_language: "Русский";
    in-out property <string> setting_datetime_mode: "Авто";
    
    // Modal selector (dims whole screen + bottom sheet).
    in-out property <bool> selector_open: false;
    in-out property <SelectionKind> selector_kind: SelectionKind.None;
    in-out property <int> selector_pending_index: 0;
    in-out property <bool> about_open: false;

    background: #00000000;

    function open_language_selector() {
        root.selector_kind = SelectionKind.Language;
        root.selector_pending_index = root.setting_language == "Русский" ? 0 : 1;
        root.selector_open = true;
    }

    function open_datetime_selector() {
        root.selector_kind = SelectionKind.DateTime;
        root.selector_pending_index = root.setting_datetime_mode == "Авто" ? 0 : 1;
        root.selector_open = true;
    }

    function apply_selector() {
        if (root.selector_kind == SelectionKind.Language) {
            root.setting_language = root.selector_pending_index == 0 ? "Русский" : "English";
        } else if (root.selector_kind == SelectionKind.DateTime) {
            root.setting_datetime_mode = root.selector_pending_index == 0 ? "Авто" : "Вручную";
        }
        root.selector_open = false;
        root.selector_kind = SelectionKind.None;
    }

    // Left navigation + right content.
    nav := Rectangle {
        x: 0px;
        y: 0px;
        width: 116px;
        height: parent.height;
        background: Theme.surface_bg_2;
        border-width: 0px;
        clip: true;

        Rectangle {
            x: parent.width - 1px;
            y: 0px;
            width: 1px;
            height: parent.height;
            background: Theme.border;
        }

        Text {
            x: 10px;
            y: 10px;
            text: "Меню";
            color: Theme.text_muted;
            font-size: Theme.font_sm;
            font-weight: 700;
        }

        menu := Rectangle {
            x: 8px;
            y: 32px;
            width: parent.width - 16px;
            height: parent.height - 40px;
            background: #00000000;

            SettingsNavScroll {
                width: parent.width;
                height: parent.height;
                reduce_motion: root.reduce_motion;
                selected_index <=> root.selected_index;
                item_count: 12;
            }
        }
    }

    detail := Rectangle {
        x: nav.width;
        y: 0px;
        width: parent.width - nav.width;
        height: parent.height;
        background: #00000000;

        // Right pane is scrollable (iOS-like long lists).
        detail_scroll := Flickable {
            width: parent.width;
            height: parent.height;
            interactive: true;

            viewport-width: parent.width;
            viewport-height: detail_content.height;

            detail_content := Rectangle {
                width: parent.width;
                height:
                    root.selected_index == 0 ? 328px
                  : root.selected_index == 1 ? 170px
                  : root.selected_index == 2 ? 170px
                  : root.selected_index == 3 ? 190px
                  : root.selected_index == 4 ? 120px
                  : 120px;
                background: #00000000;

                // "Система" (start at top, no extra heading; AppHost already has a header).
                if root.selected_index == 0 : Rectangle {
                    x: Theme.gutter;
                    y: 8px;
                    width: parent.width - Theme.gutter * 2;
                    height: parent.height;
                    background: #00000000;

                    IosSectionTitle { x: 0px; y: 0px; title: "ОБЩЕЕ"; }
                IosCard {
                    x: 0px;
                    y: 14px;
                    width: parent.width;
                    height: 96px;

                    IosSwitchRow { y: 0px; width: parent.width; title: "Тёмная тема"; value <=> root.setting_dark_mode; reduce_motion: root.reduce_motion; show_divider: true; }
                    IosSwitchRow { y: 44px; width: parent.width; title: "Уменьшить анимации"; value <=> root.setting_reduce_motion; reduce_motion: root.reduce_motion; show_divider: false; multiline: true; }
                }

                    IosSectionTitle { x: 0px; y: 122px; title: "ЯЗЫК И РЕГИОН"; }
                    IosCard {
                        x: 0px;
                        y: 136px;
                        width: parent.width;
                        height: 96px;

                        IosRowBase { y: 0px; width: parent.width; title: "Язык"; show_value: true; value_text: root.setting_language; show_divider: true; activated => { root.open_language_selector(); } }
                        IosRowBase { y: 44px; width: parent.width; title: "Дата и время"; multiline: true; show_value: true; value_text: root.setting_datetime_mode; show_divider: false; activated => { root.open_datetime_selector(); } }
                    }

                    IosSectionTitle { x: 0px; y: 244px; title: "ИНФОРМАЦИЯ"; }
                    IosCard {
                        x: 0px;
                        y: 258px;
                        width: parent.width;
                        height: 44px;

                        IosRowBase { y: 0px; width: parent.width; title: "О системе"; show_value: false; show_divider: false; activated => { root.about_open = true; } }
                    }
                }

                // Other sections: placeholders (for now).
                if root.selected_index != 0 : Rectangle {
                    x: Theme.gutter;
                    y: 0px;
                    width: parent.width - Theme.gutter * 2;
                    height: parent.height;
                    background: #00000000;

                    Text {
                        text: "Раздел пока не реализован";
                        color: Theme.text_muted;
                        font-size: Theme.font_md;
                        font-weight: 600;
                    }
                }
            }
        }
    }

    // Full-screen modal selector overlay (dims everything + bottom sheet).
    selector_overlay := Rectangle {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: parent.height;
        background: #00000000;
        visible: root.selector_open;

        Rectangle {
            width: parent.width;
            height: parent.height;
            background: Theme.scrim;
            opacity: root.selector_open ? 1.0 : 0.0;
            animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }
        }

        // Block clicks behind; tap outside does nothing (only Apply changes).
        TouchArea {
            width: parent.width;
            height: parent.height;
            enabled: root.selector_open;
            clicked => {}
            pointer-event(_) => {}
        }

        // Bottom sheet container.
        sheet := Rectangle {
            property <length> max_list_h: 220px;
            property <length> row_h: 44px;
            property <int> option_count: root.selector_kind == SelectionKind.Language ? 2 : (root.selector_kind == SelectionKind.DateTime ? 2 : 0);
            property <length> content_h: option_count * row_h;
            property <length> list_h: min(content_h, max_list_h);
            property <length> header_h: 44px;
            property <length> footer_h: 56px;

            x: 0px;
            width: parent.width;
            height: header_h + list_h + footer_h;
            y: root.selector_open ? parent.height - self.height : parent.height;
            background: Theme.surface_bg;
            border-width: 1px;
            border-color: Theme.border;
            border-radius: Theme.radius_lg;
            clip: true;

            animate y { duration: root.reduce_motion ? 0ms : Theme.anim_med; easing: ease-in-out; }

            Rectangle {
                x: (parent.width - 44px) / 2;
                y: 8px;
                width: 44px;
                height: 4px;
                border-radius: 2px;
                background: Theme.border;
                opacity: 0.75;
            }

            Text {
                x: Theme.gutter;
                y: 18px;
                text: root.selector_kind == SelectionKind.Language ? "Язык" : (root.selector_kind == SelectionKind.DateTime ? "Дата и время" : "Выбор");
                color: Theme.text;
                font-size: Theme.font_md;
                font-weight: 800;
            }

            // Options list (scrollable if needed).
            list := Flickable {
                x: 0px;
                y: sheet.header_h;
                width: parent.width;
                height: sheet.list_h;
                interactive: true;
                viewport-width: parent.width;
                viewport-height: options_container.height;

                options_container := Rectangle {
                    width: parent.width;
                    height: sheet.content_h;
                    background: #00000000;

                    if root.selector_kind == SelectionKind.Language : Rectangle {
                        width: parent.width;
                        height: parent.height;
                        IosChoiceRow { y: 0px; width: parent.width; title: "Русский"; selected: root.selector_pending_index == 0; reduce_motion: root.reduce_motion; show_divider: true; activated => { root.selector_pending_index = 0; } }
                        IosChoiceRow { y: sheet.row_h; width: parent.width; title: "English"; selected: root.selector_pending_index == 1; reduce_motion: root.reduce_motion; show_divider: false; activated => { root.selector_pending_index = 1; } }
                    }

                    if root.selector_kind == SelectionKind.DateTime : Rectangle {
                        width: parent.width;
                        height: parent.height;
                        IosChoiceRow { y: 0px; width: parent.width; title: "Авто"; selected: root.selector_pending_index == 0; reduce_motion: root.reduce_motion; show_divider: true; activated => { root.selector_pending_index = 0; } }
                        IosChoiceRow { y: sheet.row_h; width: parent.width; title: "Вручную"; selected: root.selector_pending_index == 1; reduce_motion: root.reduce_motion; show_divider: false; activated => { root.selector_pending_index = 1; } }
                    }
                }
            }

            Rectangle {
                x: 0px;
                y: sheet.header_h + sheet.list_h;
                width: parent.width;
                height: 1px;
                background: Theme.border;
            }

            IosPrimaryButton {
                x: Theme.gutter;
                y: sheet.header_h + sheet.list_h + 10px;
                width: parent.width - Theme.gutter * 2;
                text: "Применить";
                reduce_motion: root.reduce_motion;
                clicked => { root.apply_selector(); }
            }
        }
    }

    // About sheet (T-Deck profile + runtime info).
    about_overlay := Rectangle {
        x: 0px;
        y: 0px;
        width: parent.width;
        height: parent.height;
        background: #00000000;
        visible: root.about_open;

        Rectangle {
            width: parent.width;
            height: parent.height;
            background: Theme.scrim;
            opacity: root.about_open ? 1.0 : 0.0;
            animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; }
        }

        TouchArea {
            width: parent.width;
            height: parent.height;
            enabled: root.about_open;
            clicked => {}
            pointer-event(_) => {}
        }

        about_sheet := Rectangle {
            property <length> header_h: 44px;
            property <length> footer_h: 0px;
            x: 0px;
            width: parent.width;
            height: 260px;
            y: root.about_open ? parent.height - self.height : parent.height;
            background: Theme.surface_bg;
            border-width: 1px;
            border-color: Theme.border;
            border-radius: Theme.radius_lg;
            clip: true;

            animate y { duration: root.reduce_motion ? 0ms : Theme.anim_med; easing: ease-in-out; }

            Rectangle {
                x: (parent.width - 44px) / 2;
                y: 8px;
                width: 44px;
                height: 4px;
                border-radius: 2px;
                background: Theme.border;
                opacity: 0.75;
            }

            Text {
                x: Theme.gutter;
                y: 18px;
                text: "О системе";
                color: Theme.text;
                font-size: Theme.font_md;
                font-weight: 800;
            }

            Rectangle {
                x: parent.width - Theme.gutter - 64px;
                y: 12px;
                width: 64px;
                height: 28px;
                background: #00000000;

                Text {
                    width: parent.width;
                    height: parent.height;
                    text: "Готово";
                    color: Theme.accent;
                    font-size: Theme.font_sm;
                    font-weight: 800;
                    horizontal-alignment: right;
                    vertical-alignment: center;
                }

                TouchArea {
                    width: parent.width;
                    height: parent.height;
                    clicked => { root.about_open = false; }
                }
            }

            Rectangle {
                x: 0px;
                y: about_sheet.header_h;
                width: parent.width;
                height: 1px;
                background: Theme.border;
            }

            content_scroll := Flickable {
                x: 0px;
                y: about_sheet.header_h + 1px;
                width: parent.width;
                height: parent.height - about_sheet.header_h - 1px;
                interactive: true;
                viewport-width: parent.width;
                viewport-height: about_content.height;

                about_content := Rectangle {
                    width: parent.width;
                    height: 460px;
                    background: #00000000;

                    property <length> x_inset: Theme.gutter;
                    property <length> w_inset: parent.width - Theme.gutter * 2;

                    IosSectionTitle { x: x_inset; y: 10px; title: "ПРОФИЛЬ"; }
                    IosCard {
                        x: x_inset;
                        y: 24px;
                        width: w_inset;
                        height: 132px;

                        IosRowBase { y: 0px; width: parent.width; title: "Устройство"; show_chevron: false; show_value: true; value_text: "T‑Deck"; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 44px; width: parent.width; title: "Форм‑фактор"; multiline: true; show_chevron: false; show_value: true; value_text: "портативный, клавиатура"; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 88px; width: parent.width; title: "Цель UI"; show_chevron: false; show_value: true; value_text: "320×240"; show_divider: false; reduce_motion: root.reduce_motion; activated => {}; }
                    }

                    IosSectionTitle { x: x_inset; y: 170px; title: "АППАРАТНО (ОБЩЕЕ)"; }
                    IosCard {
                        x: x_inset;
                        y: 184px;
                        width: w_inset;
                        height: 176px;

                        IosRowBase { y: 0px; width: parent.width; title: "Платформа"; show_chevron: false; show_value: true; value_text: "ESP32‑S3 class"; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 44px; width: parent.width; title: "Связь"; show_chevron: false; show_value: true; value_text: "Wi‑Fi / BLE"; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 88px; width: parent.width; title: "Экран"; show_chevron: false; show_value: true; value_text: "TFT, 320×240"; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 132px; width: parent.width; title: "Питание"; show_chevron: false; show_value: true; value_text: "LiPo"; show_divider: false; reduce_motion: root.reduce_motion; activated => {}; }
                    }

                    IosSectionTitle { x: x_inset; y: 374px; title: "СБОРКА"; }
                    IosCard {
                        x: x_inset;
                        y: 388px;
                        width: w_inset;
                        height: 132px;

                        IosRowBase { y: 0px; width: parent.width; title: "Версия"; show_chevron: false; show_value: true; value_text: root.app_version; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 44px; width: parent.width; title: "Среда"; show_chevron: false; show_value: true; value_text: root.runtime_platform; show_divider: true; reduce_motion: root.reduce_motion; activated => {}; }
                        IosRowBase { y: 88px; width: parent.width; title: "UI"; show_chevron: false; show_value: true; value_text: "Slint 1.14"; show_divider: false; reduce_motion: root.reduce_motion; activated => {}; }
                    }
                }
            }
        }
    }
}
