import { Theme } from "theme.slint";

export component AppIcon inherits Rectangle {
    in property <string> label: "";
    in property <image> icon;
    in property <bool> compact: false;
    in property <bool> reduce_motion: false;

    callback activated(string);

    background: #00000000;
    clip: true;

    out property <bool> pressed: touch.pressed;
    property <bool> pulse: false;
    property <bool> active: root.pressed || root.pulse;

    property <length> press_depth: root.compact ? 5px : 4px;
    property <length> press_offset: root.active ? press_depth : 0px;
    animate press_offset { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }

    pulse_timer := Timer {
        interval: 120ms;
        running: false;
        triggered => {
            self.running = false;
            root.pulse = false;
        }
    }

    // Subtle press feedback (no card/background).
    Rectangle {
        property <length> size: root.compact ? 76px : 60px;
        x: (parent.width - self.size) / 2;
        y: (root.compact ? 6px : 8px) + root.press_offset;
        width: self.size;
        height: self.size;
        border-radius: 12px;
        background: Theme.focus_ring;
        opacity: root.active ? 1.0 : 0.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    img := Image {
        property <length> img_size: root.compact ? 66px : 52px;
        x: (parent.width - self.img_size) / 2;
        y: (root.compact ? 8px : 10px) + root.press_offset;
        width: self.img_size;
        height: self.img_size;
        source: root.icon;
        image-fit: contain;
        opacity: root.active ? 0.78 : 1.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    Text {
        x: 6px;
        y: img.y + img.height + (root.compact ? 6px : 8px) + root.press_offset;
        width: parent.width - 12px;
        height: root.compact ? 14px : 16px;
        text: root.label;
        color: Theme.text_dim;
        font-size: root.compact ? Theme.font_xs : Theme.font_sm;
        font-weight: 500;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    // Extra feedback visible even on very fast clicks.
    Rectangle {
        width: parent.width;
        height: parent.height;
        background: #00000010;
        opacity: root.active ? 1.0 : 0.0;
        animate opacity { duration: root.reduce_motion ? 0ms : Theme.anim_fast; easing: ease-out; }
    }

    touch := TouchArea {
        width: parent.width;
        height: parent.height;
        clicked => {
            if (!root.reduce_motion) {
                root.pulse = true;
                pulse_timer.running = true;
            }
            root.activated(root.label);
        }
    }
}
